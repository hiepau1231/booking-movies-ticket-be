# Active Context

## Current Focus
- Refining API integrations and improving user-facing features, continuing with the "Next Steps" in priority order:
    - Implementing Movie Browsing UI
    - Creating User Profile and Booking History
    - Testing the completed features with focus on API integrations
    - Comprehensive Vietnamese localization across all UI components

## Recent Changes
- **MovieForm Routes Refinement**:
    - Created a new `MovieFormWrapper.tsx` component to handle data fetching and state management:
        - Implemented proper data fetching for movie edit mode using `useQuery`
        - Added loading and error states
        - Created mock API functions for create/update operations using `useMutation`
        - Handled navigation after save/cancel actions
    - Created centralized type definitions:
        - Added `admin-interface/src/types/movie.ts` with `Movie` and `MovieFormData` interfaces
        - Created a barrel file `admin-interface/src/types/index.ts` for clean imports
    - Updated `MovieForm.tsx` to:
        - Use the new centralized type definitions
        - Handle file uploads properly with the `posterFile` field
        - Improve the component interface to work with `MovieFormData`
    - Updated `routes.tsx` to use `MovieFormWrapper` instead of directly using `MovieForm`
    - Updated `MovieManagement.tsx` to:
        - Use the new centralized type definitions
        - Update the `handleSave` function to work with `MovieFormData`
        - Add proper handling for poster file uploads
    - Used consistent barrel imports across components for better maintainability
- **User Authentication UI Implementation**:
    - Updated `Login.tsx` with existing API call logic and UI.
    - Significantly updated `Register.tsx`:
        - Added state management using Formik.
        - Implemented validation using Yup.
        - Added logic to call the registration API endpoint.
        - Included loading and error/success message handling.
        - Integrated `useTranslation` for i18n.
        - Added link to Login page.
    - Verified routes in `routes.tsx`.
- **API Integration for User-Facing Booking System**:
    - Created `bookingService.ts` service file for handling all booking-related API calls
    - Implemented interfaces for booking data types (Showtime, Seat, FoodItem, etc.)
    - Updated `BookingForm.tsx` to replace mock data with real API calls
    - Added proper error handling and loading states
    - Implemented symbolic payment process that simulates payment without actual gateway integration
    - Added booking success UI with booking details display
    - Structured API endpoints to match expected backend structure
- **Movie Schedule Calendar Integration for Rooms**:
    - Added a "Calendar" button to the `RoomManagement` component that links to room-specific showtimes.
    - Created a new `RoomScheduleCalendar` component, adapting `MovieScheduleCalendar` for room-specific views.
    - Implemented room-specific filtering of showtimes in `RoomScheduleCalendar`.
    - Added new routes for room schedules in `routes.tsx`.
    - Enabled features for viewing, adding, editing, and deleting movie showtimes for specific rooms, including time zone selection and date/time management.
    - Fixed linter error related to `RoomScheduleCalendar` import in `routes.tsx`.
- **Room Management UI Enhancements**:
    - Improved the title area of the `RoomManagement` page by adding padding and a bottom border for better visual separation.
    - Added padding to the `Paper` component that wraps the `DataGrid` for a less cramped look.
    - Configured `DataGrid` columns (`id`, `name`, `theaterName`, `roomType`, `status`) to use `flex` and `minWidth` properties, allowing them to distribute space more effectively and fill the table width. Adjusted fixed widths for `capacity`, `dimensions`, and `actions` columns.
    - Styled `DataGrid` column headers with a background color, bottom border, and bolded titles for improved readability.
- **Movie Schedule Calendar Implementation**:
    - Created a new `MovieScheduleCalendar.tsx` component using FullCalendar for a calendar-based movie schedule management interface.
    - Implemented time zone support with multiple selectable time zones (Vietnam, Bangkok, Singapore, Tokyo, London, New York).
    - Added interactive functionality for creating, editing, and deleting movie schedules.
    - Implemented filtering by cinema, movie, and room with dynamic room filtering based on selected cinema.
    - Added a dialog for schedule creation and editing with form validation.
    - Created comprehensive Vietnamese translations for all calendar UI elements.
    - Added the navigation item back to the sidebar under the Movies Management section.
    - Styled with Material-UI components to maintain design consistency.
- **Admin Panel Navigation Update**:
    - Removed "Lịch chiếu phim" (Movie Schedules) tab from the movies management section in the sidebar navigation.
    - Deleted the MovieSchedules.tsx component as it's no longer needed.
    - Updated progress.md to reflect this change.
- **Admin Panel Navigation Update**:
    - Removed "Vai trò & Phân quyền" (Roles & Permissions) tab from the user management section in the sidebar navigation.
    - Deleted the RolesManagement.tsx component as it's no longer needed.
    - Updated progress.md to reflect this change.
- **Admin Panel Placeholder Components - Enhanced Implementation**:
    - **RoomManagement.tsx**: Implemented with mock data for cinema rooms (2D, 3D, IMAX, VIP), added DataGrid display with comprehensive CRUD operations, form validation using Formik/Yup, and visual status indicators.
    - **PromotionsManagement.tsx**: Created rich mock data for different promotion types (percentage/fixed discounts), various targets (all/movie/food/combo), date range selection with Vietnamese localization, and comprehensive form validation.
    - **TheaterLocations.tsx**: Enhanced with theater location mock data, dual view modes (grid/list), Google Maps integration, search functionality, and detailed location management. Had linter errors regarding missing `MenuItem` imports which were attempted to be fixed.
    - All implementations maintained consistency with the existing UI patterns, used Material-UI components, included Vietnamese translations, and followed the project's established design conventions.
- **User-Facing Booking System - Full Implementation**:
    - Completed all four steps of the multi-step booking form in `BookingForm.tsx`:
        - **Showtime Selection**: Implemented UI for displaying available showtimes with movie time, room name, and available seats. Added state management for selected showtime and form validation.
        - **Seat Selection**: Created an interactive seat map with visual representation of rows and seats. Implemented seat status management (Available, Booked, Selected, Unavailable) with appropriate styling and click handlers for seat selection/deselection.
        - **Food & Drinks**: Built a grid layout of available food items with images, names, prices, and quantity selectors. Implemented state management for selected items and quantities.
        - **Confirm & Pay**: Designed a comprehensive booking summary showing details of selected showtime, seats, food items with quantities and subtotals, a grand total calculation, and payment method options.
    - Added appropriate TypeScript interfaces for all form components (`Showtime`, `Seat`, `SeatStatus`, `FoodItem`, `FoodSelection`).
    - Implemented form validation using Formik and Yup for all steps.
    - Added proper state management between form steps to ensure data consistency.
    - Added loading states and error handling for each step.
    - Currently using mock data with simulated API delays.
- **Vietnamese Localization**:
    - Added comprehensive Vietnamese translations for the entire booking form UI in `admin-interface/src/locales/vi/translation.json`.
    - Added a dedicated `booking` section in the translation file with nested keys for all UI elements.
    - Ensured proper use of the translation function `t()` throughout the booking form for consistent Vietnamese display.
    - Added Vietnamese translations for new placeholder components (RoomManagement, PromotionsManagement, TheaterLocations).
- **Linter Error Resolution**:
    - Fixed TypeScript errors in `BookingForm.tsx` related to formik validation by properly handling field error checks.
    - Resolved issues with `Register.tsx` import in `routes.tsx` which was causing persistent linter errors.
    - Explicitly typed Formik's fields to prevent TypeScript "argument of type string is not assignable to type never" errors.
    - Encountered but couldn't fully resolve import errors in TheaterLocations.tsx related to MenuItem components.
- **Vietnamese Localization Enhancements**:
    - Fixed translation issues in the user interface components for better Vietnamese language support:
        - Added comprehensive translations for Register page including form labels and validation messages
        - Added translations for the UserHeader component including profile dropdown menu items
        - Added translations for UserProfile component with personal information editing and password changing sections
        - Added translations for BookingHistory component with filtering tabs and booking details display
        - Added translations for the Footer component with all links and information sections
    - Organized translations hierarchically in the i18n structure to match UI component hierarchy:
        - Created separate translation namespaces (auth, profile, booking, bookings.history, etc.) for better organization
        - Added proper validation message translations for form validation
        - Ensured consistent translation keys across similar components
    - Fixed TypeScript errors in UserHeader component related to property access

## Next Steps
1. ~~**Create User Profile and Booking History**~~ (Completed):
   * ~~Design and implement user profile page~~ - Implemented with personal info editing, avatar upload, and password changing
   * ~~Create booking history view~~ - Implemented with filtering (All/Upcoming/Past), booking details dialog, and proper status indicators
   * ~~Add Vietnamese translations~~ - Added for all UI elements and status indicators
   * ~~Ensure mobile responsiveness~~ - Implemented responsive design for all screen sizes
   * ~~Connect to relevant API endpoints~~ - Connected to `/user/profile` and `/user/bookings` endpoints
2. **Testing**: Conduct a thorough review and test of the implemented features, especially the authentication flow and booking form.
3. **Data Integration**: Xử lý vấn đề dữ liệu cho các UI hiện tại:
   * Triển khai mock data cho Movie Browsing UI nếu backend chưa sẵn sàng
   * Tạo các hàm API service giả lập để đảm bảo UI hoạt động mà không cần backend đầy đủ
4. **UI Polish**: Review all user-facing components to ensure consistent styling and proper Vietnamese translations.

## Active Decisions
- Using JPA for entity relationships
- Implementing lazy loading for entity relationships
- Using enum for booking status management
- Using Apache POI for Excel export functionality
- Implementing date range selection with Vietnamese localization
- Separating sales and attendance reports into tabs
- Using Material-UI components for consistent design
- Using Recharts for data visualization
- Temporarily bypassing authentication for UI development
- Using @tanstack/react-query for data fetching
- Implementing TypeScript 5.3.3 for better type safety
- Using mock data for development
- Using a consistent sidebar navigation structure with collapsible groups
- Implementing path prefixes for proper route nesting
- Creating placeholder components for all sidebar menu items
- Using placeholder `null` props and empty functions in `routes.tsx` for `MovieForm` as a temporary measure to satisfy TypeScript until full data flow is implemented.
- Structuring the user-facing booking process as a multi-step form (`BookingForm.tsx`) for better UX.
- Using a component-based approach for seat visualization in the booking form.
- Implementing a grid layout for food & drink items with quantity controls.
- Using helper functions to calculate subtotals and totals in the booking summary.
- Using Material-UI DataGrid for consistent data table presentation in admin components.
- Implementing view mode toggles (grid/list) for location-based data visualization.
- Providing rich mock data that closely resembles expected production data patterns.
- Điều hướng trang chủ mặc định đến trang Movie List để tạo trải nghiệm người dùng tốt hơn
- Sử dụng React Query cho việc tải dữ liệu phim với các trạng thái loading và error

## Important Patterns
- JPA entity relationships
- Status management using enums
- Consistent use of Material-UI components
- Vietnamese language support throughout
- Responsive grid layout
- Error handling and loading states
- Modular component structure
- RESTful API design
- Data aggregation patterns
- Excel export functionality
- Authentication bypass for development
- React Query patterns for data fetching
- Error handling patterns
- Loading state patterns
- Chart visualization patterns
- Responsive design patterns
- Translation patterns
- Mock data patterns
- TypeScript type definitions
- Component composition patterns
- Consistent navigation patterns with proper route nesting
- Placeholder component patterns for progressive UI development
- Handling potential type mismatches between form data (e.g., `File` for uploads) and data model types (e.g., `string` for image URLs) during data transformation.
- Using a multi-step stepper (`@mui/material/Stepper`) for complex forms like the booking process.
- Using typed form interfaces with Formik to prevent TypeScript errors.
- Using conditional rendering based on loading and data states.
- Breaking down complex UIs into smaller, focused components.
- Using helper functions to transform and process data for display.
- Handling form state across multiple steps in a multi-step form.
- Explicitly typing form values in Formik to improve TypeScript inference.
- View mode toggles (grid/list) for different data visualization contexts.
- Common dialog pattern for CRUD operations across admin components.
- Status indicators with consistent color coding (success/error/warning).
- Creating wrapper components (like `MovieFormWrapper`) to separate data fetching and UI rendering concerns.
- Using barrel files for clean and maintainable imports.
- Hiển thị nội dung có điều kiện dựa trên trạng thái dữ liệu (loading, error, empty)
- Sử dụng các tab để phân loại dữ liệu (tất cả phim, đang chiếu, sắp chiếu)
- Hierarchy-based translation structure matching component structure
- Namespace organization for translations based on feature domains

## Project Insights
- Entity relationships are crucial for data integrity
- Status management improves workflow control
- Data visualization is crucial for effective reporting
- Date range selection is essential for flexible reporting
- Export functionality is important for data analysis
- Vietnamese localization improves user experience
- Responsive design ensures usability across devices
- Backend data aggregation is critical for performance
- UI development can be decoupled from backend for faster iteration
- React Query significantly improves data fetching and state management
- TypeScript version compatibility is crucial for project stability
- Proper error handling improves user experience
- Loading states are essential for user feedback
- Mock data helps in UI development without backend dependency
- Vietnamese localization needs to be consistent across all features
- Chart visualization requires careful consideration of data structure
- Responsive design is crucial for different screen sizes
- Consistent navigation patterns are important for user experience
- Placeholder components allow for progressive development
- Proper route nesting is essential for maintaining layout consistency
- Recharts animation props (`animationBegin`, `animationDuration`, `animationEasing`) are not consistently top-level props for chart components; it's often better to rely on default animations or apply them to specific chart elements if fine-grained control is needed.
- When introducing new components and their associated routes, ensuring all file dependencies (e.g., `Register.tsx` for `routes.tsx`) are correctly created and referenced is crucial to prevent build/linter errors.
- Type mismatches, especially with file inputs (e.g., `File` vs. `string` for `imageUrl`), are common when bridging form data with backend/display models and require careful handling in data submission logic.
- Multi-step forms require careful state management to ensure data consistency between steps.
- Explicitly typing form fields in Formik helps TypeScript correctly infer types and prevent errors.
- Vietnamese translations should be organized hierarchically to match the UI structure
- Providing fallback text in the t() function helps with development and ensures graceful degradation
- Translation keys should follow a consistent naming convention across similar components
- Separating translations into logical namespaces improves maintainability and organization
- Translations should be tested with actual UI rendering to catch any display or formatting issues
- Translation file structure should mirror component organization for easier maintenance

## Areas for Improvement
- Add more chart customization options
- Implement better data caching strategies
- Add more interactive features to charts
- Enhance export functionality
- Improve loading state animations
- Add more detailed error messages
- Optimize chart performance
- Enhance mock data generation
- Improve TypeScript type definitions
- Add unit tests for chart components
- Add more filtering and sorting options
- Enhance export functionality with more formats
- Add print functionality for reports
- Optimize database queries for large datasets
- Add booking validation rules
- Implement booking cancellation workflow
- Add mock data for offline UI development
- Implement proper error states for offline mode
- Complete content for placeholder pages
- Add more interactive elements to management interfaces
- Enhance form validation with more comprehensive rules
- The booking form needs real API integration to replace the current mock data.
- Add animations for smoother transitions between booking form steps.
- Implement better mobile responsiveness for the seat selection UI.
- Add more detailed validation feedback for each booking step.
- Consider implementing a seat category system with different pricing.
- Add visual indicators of selected seats count and total price on all steps.
- Implement actual payment processing integration.
- Add booking confirmation emails/notifications.
- Implement a booking history view for users.
- Fix import errors in TheaterLocations.tsx related to MenuItem components.
- Add more sophisticated filtering options to DataGrid components.
- Implement proper error handling for image upload failures.
- Add confirmation dialogs for critical actions (delete, status changes).
- Triển khai mock data cho Movie Browsing UI khi backend chưa sẵn sàng
- Thêm tính năng đánh giá và bình luận cho phim
- Tối ưu hóa hiệu suất tải trang với số lượng phim lớn
- Cải thiện UX cho việc tìm kiếm và lọc phim

## Current Considerations
- API integration approach for the booking form
- How to structure API endpoints for the multi-step booking process
- Best practices for handling seat availability in real-time
- Symbolic payment implementation (no actual payment gateway for internship project)
- Performance optimization for seat map rendering with large theaters
- State management for complex forms across multiple steps
- Optimistic UI updates for better user experience
- Error recovery strategies for failed API calls
- Mobile-friendly design for seat selection
- Real-time seat availability updates
- Booking expiration handling
- Cancel/edit booking functionality
- Email confirmation integration
- PDF ticket generation
- QR code generation for tickets
- Seat pricing categories
- Food & drink inventory management
- Discount code application
- Season pass/membership integration
- Analytics for popular seats/food items
- A/B testing for booking flow optimization
- Best approach for role-based permission management
- Integration of Google Maps for theater locations
- Handling real-time room availability updates
- Promotion code validation and application workflow
- Security considerations for user profile data
- Optimizing API calls for booking history to handle large datasets
- Implementing real-time booking status updates
- Error handling strategies for API integration failures
- Ensuring consistent Vietnamese translations across all components
- Implementing proper locale detection and switching
- Maintaining translation key consistency across components

## Learnings
- JPA entity relationship implementation
- Status management using enums
- Effective use of Recharts for data visualization
- Implementation of date range selection with localization
- Export functionality for reports using Apache POI
- Vietnamese translation integration
- Responsive design patterns
- Backend data aggregation techniques
- Excel export implementation
- UI development strategies without backend dependency
- React Query setup and configuration
- TypeScript version management
- Chart library implementation
- Error handling strategies
- Loading state patterns
- Mock data generation
- Vietnamese localization techniques
- Responsive design approaches
- Export functionality implementation
- Proper route nesting and layout structure
- Creation of placeholder components for progressive development
- Navigation patterns for complex admin interfaces
- Effective use of Material-UI `Stepper` for creating guided multi-step user flows.
- Strategies for resolving TypeScript errors related to component prop mismatches in routing definitions (e.g., using placeholder props).
- Techniques for harmonizing UI elements (e.g., sidebar, dashboard) for a consistent look and feel.
- Debugging and correcting Recharts prop usage for chart components.
- Building complex interactive UIs like seat selection maps with proper state management.
- Implementing quantity selectors for catalog items (food & drinks).
- Organizing translation keys hierarchically to match UI structure.
- Using TypeScript interfaces to model domain entities (Showtime, Seat, Food items).
- Calculating derived values from form state (subtotals, totals).
- Implementing view mode toggles for different data visualization contexts.
- Creating rich mock data that closely resembles expected production data.
- Using Material-UI DataGrid for efficient data presentation.
- Implementing comprehensive CRUD operations with consistent UI patterns. 